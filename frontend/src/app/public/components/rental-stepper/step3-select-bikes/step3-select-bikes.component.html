<p-card *ngIf="!error; else errorBlock">
  <ng-template pTemplate="header">
    <div class="card-header">
      <h2 class="header-white">{{ 'public.rental.bikes.title' | transloco }}</h2>
      <p>{{ 'public.rental.bikes.subtitle' | transloco }}</p>
    </div>
  </ng-template>

  <div class="grid" *ngIf="needs">
    <div class="grid-column">
      <div class="column-header">
        <h3>{{ 'public.rental.bikes.men' | transloco }}</h3>
        <span class="badge">{{ selectedMen.size }}/{{ needs.men }}</span>
      </div>
      <div class="card" *ngFor="let bike of men">
        <div class="card-body" [class.selected]="selectedMen.has(bike.id)">
          <div class="info">
            <div class="title">{{ bike.name }}</div>
            <div class="subtitle">{{ 'public.bike.size' | transloco }}: {{ bike.size }}</div>
          </div>
          <button
            pButton
            [label]="
              selectedMen.has(bike.id)
                ? ('public.rental.bikes.selected' | transloco)
                : ('public.rental.bikes.select' | transloco)
            "
            (click)="toggleSelection('men', bike.id)"
            [disabled]="!selectedMen.has(bike.id) && selectedMen.size >= needs.men"
          ></button>
        </div>
      </div>
    </div>

    <div class="grid-column">
      <div class="column-header">
        <h3>{{ 'public.rental.bikes.women' | transloco }}</h3>
        <span class="badge">{{ selectedWomen.size }}/{{ needs.women }}</span>
      </div>
      <div class="card" *ngFor="let bike of women">
        <div class="card-body" [class.selected]="selectedWomen.has(bike.id)">
          <div class="info">
            <div class="title">{{ bike.name }}</div>
            <div class="subtitle">{{ 'public.bike.size' | transloco }}: {{ bike.size }}</div>
          </div>
          <button
            pButton
            [label]="
              selectedWomen.has(bike.id)
                ? ('public.rental.bikes.selected' | transloco)
                : ('public.rental.bikes.select' | transloco)
            "
            (click)="toggleSelection('women', bike.id)"
            [disabled]="!selectedWomen.has(bike.id) && selectedWomen.size >= needs.women"
          ></button>
        </div>
      </div>
    </div>

    <div class="grid-column">
      <div class="column-header">
        <h3>{{ 'public.rental.bikes.children' | transloco }}</h3>
        <span class="badge">{{ selectedChildren.size }}/{{ needs.children }}</span>
      </div>
      <div class="card" *ngFor="let bike of children">
        <div class="card-body" [class.selected]="selectedChildren.has(bike.id)">
          <div class="info">
            <div class="title">{{ bike.name }}</div>
            <div class="subtitle">{{ 'public.bike.size' | transloco }}: {{ bike.size }}</div>
          </div>
          <button
            pButton
            [label]="
              selectedChildren.has(bike.id)
                ? ('public.rental.bikes.selected' | transloco)
                : ('public.rental.bikes.select' | transloco)
            "
            (click)="toggleSelection('children', bike.id)"
            [disabled]="!selectedChildren.has(bike.id) && selectedChildren.size >= needs.children"
          ></button>
        </div>
      </div>
    </div>
  </div>

  <div class="accessory-section" *ngIf="accessories.length && needs">
    <div class="column-header">
      <h3>{{ 'public.rental.bikes.accessories' | transloco }}</h3>
      <span class="badge">{{ selectedAccessories.size }}</span>
    </div>
    <div class="chips">
      <p-chip
        *ngFor="let accessory of accessories"
        [label]="accessory.name"
        [removable]="selectedAccessories.has(accessory.id)"
        (onRemove)="toggleAccessory(accessory.id, needs.accessories[accessory.id] || 0)"
        (click)="toggleAccessory(accessory.id, needs.accessories[accessory.id] || 0)"
        [ngClass]="{ selected: selectedAccessories.has(accessory.id) }"
      ></p-chip>
    </div>
  </div>

  <div class="actions">
    <button pButton [label]="'shared.back' | transloco" class="p-button-text" icon="pi pi-arrow-left" (click)="back.emit()"></button>
    <button pButton [label]="'public.cta.book' | transloco" icon="pi pi-check" (click)="onConfirm()"></button>
  </div>
</p-card>

<ng-template #errorBlock>
  <p-card>
    <ng-template pTemplate="header">
      <div class="card-header">
        <h2>{{ 'public.rental.errors.noAvailability' | transloco }}</h2>
      </div>
    </ng-template>

    <p class="error-text">{{ error }}</p>
    <p *ngIf="contactInfo">
      {{ 'public.rental.errors.contactPrompt' | transloco }}<br />
      {{ 'public.contact.email' | transloco }}: {{ contactInfo.email }}<br />
      {{ 'public.contact.phone' | transloco }}: {{ contactInfo.phone }}
    </p>

    <div class="actions">
      <button pButton [label]="'public.rental.errors.home' | transloco" icon="pi pi-home" routerLink="/"></button>
    </div>
  </p-card>
</ng-template>
